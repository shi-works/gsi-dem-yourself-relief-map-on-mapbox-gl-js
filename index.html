<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>自分で作る色別標高図（Mapzen Terrain Tiles）</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.0/mapbox-gl.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoic2hpd29ya3MiLCJhIjoiY2szeHZjeXJsMDJzdDNsbXczdnN1b3hpNiJ9.VQg_5pGbF1qU_6FZ33Uf4g';

    const map = new mapboxgl.Map({
      container: "map",
      style: 'https://tile.openstreetmap.jp/styles/maptiler-basic-ja/style.json',
      hash: true,
      center: {
        lat: 35.828,
        lng: 140.048
      },
      zoom: 8.26,
      language: 'ja',
      attributionControl: false
    });

    // ズーム・回転
    map.addControl(new mapboxgl.NavigationControl(), 'top-left');

    // フルスクリーンモードのオンオフ
    map.addControl(new mapboxgl.FullscreenControl(), 'top-left');

    // 現在位置表示
    map.addControl(new mapboxgl.GeolocateControl({
      positionOptions: {
        enableHighAccuracy: false
      },
      fitBoundsOptions: { maxZoom: 18 },
      trackUserLocation: true,
      showUserLocation: true
    }), 'top-left');

    // スケール表示
    map.addControl(new mapboxgl.ScaleControl({
      maxWidth: 200,
      unit: 'metric'
    }));

    // Attributionを折りたたみ表示
    map.addControl(new mapboxgl.AttributionControl({
      compact: true,
      customAttribution: '（<a href="https://twitter.com/shi__works" target="_blank">Twitter</a> | <a href="https://github.com/shi-works/japan-sea-level-rise-map-on-mapbox-gl-js" target="_blank">Github</a>） '
    }));

    // 地図がロードされたら実行
    map.on('load', () => {
      // Mapzen標高タイルソース
      map.addSource("mapzen-terrain", {
        type: 'raster-dem',
        tiles: ['https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png'],
        attribution: '<a href="https://github.com/tilezen/joerd/blob/master/docs/attribution.md">Tilezen Joerd: Attribution</a>',
        encoding: "terrarium"
      });

      // Mapzen標高タイルセット
      map.setTerrain({ 'source': 'mapzen-terrain', 'exaggeration': 1 });

      // Mapzen標高タイルソース
      map.addSource("mapzen-terrain-raster", {
        type: 'raster',
        tiles: ['https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png'],
        attribution: '<a href="https://github.com/tilezen/joerd/blob/master/docs/attribution.md">Tilezen Joerd: Attribution</a>'
      });

      var colors = {
        "-0": '#7B77D8',
        "0-250": '#72D3FE',
        "250-500": '#72FED9',
        "500-750": '#74FF8A',
        "750-1000": '#AAFE72',
        "1000-1250": '#F9FF74',
        "1000-1250": '#F9FF74',
        "1250-1500": '#FDB271',
        "1500-1750": '#FF7380',
        "1750-2000": '#FE72D2',
        "2000-": '#F274FC'
      };

      // Mapzen標高タイルラスターレイヤ
      map.addLayer({
        id: 'mapzen-terrain-raster',
        source: 'mapzen-terrain-raster',
        type: 'raster',
        paint: {
          'raster-color': [
            'interpolate',
            ['linear'],
            ['raster-value'],
            0, colors['-0'],
            250, colors['0-250'],
            500, colors['250-500'],
            750, colors['500-750'],
            1000, colors['750-1000'],
            1250, colors['1000-1250'],
            1500, colors['1250-1500'],
            1750, colors['1500-1750'],
            2000, colors['1750-2000'],
            4000, colors['2000-']
          ],
          'raster-color-mix': [
            255 * 2 ** 8,
            255,
            255 / 2 ** 8,
            -32768
          ],
          'raster-color-range': [0, 4000],
          'raster-opacity': 0.7,
          'raster-resampling': 'nearest'
        }
      })

      var gui = new dat.GUI();
      gui.addColor(colors, '-0').onChange(setReliefColors);
      gui.addColor(colors, '0-250').onChange(setReliefColors);
      gui.addColor(colors, '250-500').onChange(setReliefColors);
      gui.addColor(colors, '500-750').onChange(setReliefColors);
      gui.addColor(colors, '750-1000').onChange(setReliefColors);
      gui.addColor(colors, '1000-1250').onChange(setReliefColors);
      gui.addColor(colors, '1250-1500').onChange(setReliefColors);
      gui.addColor(colors, '1500-1750').onChange(setReliefColors);
      gui.addColor(colors, '1750-2000').onChange(setReliefColors);
      gui.addColor(colors, '2000-').onChange(setReliefColors);

      function setReliefColors() {
        map.setPaintProperty('mapzen-terrain-raster', 'raster-color', [
          'interpolate',
          ['linear'],
          ['raster-value'],
          0, colors['-0'],
          250, colors['0-250'],
          500, colors['250-500'],
          750, colors['500-750'],
          1000, colors['750-1000'],
          1250, colors['1000-1250'],
          1500, colors['1250-1500'],
          1750, colors['1500-1750'],
          2000, colors['1750-2000'],
          4000, colors['2000-']
        ]);
      }

    })
  </script>

</body>

</html>